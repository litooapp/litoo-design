// Version 0.3.1
// Full source at https://github.com/rvera/image-picker
(function(){var a,b,c,d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};jQuery.fn.extend({imagepicker:function(b){return null==b&&(b={}),this.each(function(){var c;if(c=jQuery(this),c.data("picker")&&c.data("picker").destroy(),c.data("picker",new a(this,d(b))),null!=b.initialized)return b.initialized.call(c.data("picker"))})}}),d=function(a){var b;return b={hide_select:!0,show_label:!1,initialized:void 0,changed:void 0,clicked:void 0,selected:void 0,limit:void 0,limit_reached:void 0},jQuery.extend(b,a)},c=function(a,b){var c,d,e,f;if(!a||!b||a.length!==b.length)return!1;for(a=a.slice(0),b=b.slice(0),a.sort(),b.sort(),c=d=0,e=a.length;d<e;c=++d)if(f=a[c],b[c]!==f)return!1;return!0},a=function(){function a(a,b){this.opts=null!=b?b:{},this.sync_picker_with_select=e(this.sync_picker_with_select,this),this.select=jQuery(a),this.multiple="multiple"===this.select.attr("multiple"),null!=this.select.data("limit")&&(this.opts.limit=parseInt(this.select.data("limit"))),this.build_and_append_picker()}return a.prototype.destroy=function(){var a,b,c,d;for(d=this.picker_options,a=0,b=d.length;a<b;a++)c=d[a],c.destroy();return this.picker.remove(),this.select.off("change",this.sync_picker_with_select),this.select.removeData("picker"),this.select.show()},a.prototype.build_and_append_picker=function(){return this.opts.hide_select&&this.select.hide(),this.select.on("change",this.sync_picker_with_select),null!=this.picker&&this.picker.remove(),this.create_picker(),this.select.after(this.picker),this.sync_picker_with_select()},a.prototype.sync_picker_with_select=function(){var a,b,c,d,e;for(d=this.picker_options,e=[],a=0,b=d.length;a<b;a++)c=d[a],c.is_selected()?e.push(c.mark_as_selected()):e.push(c.unmark_as_selected());return e},a.prototype.create_picker=function(){return this.picker=jQuery("<ul class='thumbnails image_picker_selector'></ul>"),this.picker_options=[],this.recursively_parse_option_groups(this.select,this.picker),this.picker},a.prototype.recursively_parse_option_groups=function(a,c){var d,e,f,g,h,i,j,k,l,m;for(k=a.children("optgroup"),e=0,g=k.length;e<g;e++)j=k[e],j=jQuery(j),d=jQuery("<ul></ul>"),d.append(jQuery("<li class='group_title'>"+j.attr("label")+"</li>")),c.append(jQuery("<li class='group'>").append(d)),this.recursively_parse_option_groups(j,d);for(l=function(){var c,d,e,f;for(e=a.children("option"),f=[],c=0,d=e.length;c<d;c++)i=e[c],f.push(new b(i,this,this.opts));return f}.call(this),m=[],f=0,h=l.length;f<h;f++)i=l[f],this.picker_options.push(i),i.has_image()&&m.push(c.append(i.node));return m},a.prototype.has_implicit_blanks=function(){var a;return function(){var b,c,d,e;for(d=this.picker_options,e=[],b=0,c=d.length;b<c;b++)a=d[b],a.is_blank()&&!a.has_image()&&e.push(a);return e}.call(this).length>0},a.prototype.selected_values=function(){return this.multiple?this.select.val()||[]:[this.select.val()]},a.prototype.toggle=function(a,b){var d,e,g;if(e=this.selected_values(),g=a.value().toString(),this.multiple?f.call(this.selected_values(),g)>=0?(d=this.selected_values(),d.splice(jQuery.inArray(g,e),1),this.select.val([]),this.select.val(d)):null!=this.opts.limit&&this.selected_values().length>=this.opts.limit?null!=this.opts.limit_reached&&this.opts.limit_reached.call(this.select):this.select.val(this.selected_values().concat(g)):this.has_implicit_blanks()&&a.is_selected()?this.select.val(""):this.select.val(g),!c(e,this.selected_values())&&(this.select.change(),null!=this.opts.changed))return this.opts.changed.call(this.select,e,this.selected_values(),b)},a}(),b=function(){function a(a,b,c){this.picker=b,this.opts=null!=c?c:{},this.clicked=e(this.clicked,this),this.option=jQuery(a),this.create_node()}return a.prototype.destroy=function(){return this.node.find(".thumbnail").off("click",this.clicked)},a.prototype.has_image=function(){return null!=this.option.data("img-src")},a.prototype.is_blank=function(){return!(null!=this.value()&&""!==this.value())},a.prototype.is_selected=function(){var a;return a=this.picker.select.val(),this.picker.multiple?jQuery.inArray(this.value(),a)>=0:this.value()===a},a.prototype.mark_as_selected=function(){return this.node.find(".thumbnail").addClass("selected")},a.prototype.unmark_as_selected=function(){return this.node.find(".thumbnail").removeClass("selected")},a.prototype.value=function(){return this.option.val()},a.prototype.label=function(){return this.option.data("img-label")?this.option.data("img-label"):this.option.text()},a.prototype.clicked=function(a){if(this.picker.toggle(this,a),null!=this.opts.clicked&&this.opts.clicked.call(this.picker.select,this,a),null!=this.opts.selected&&this.is_selected())return this.opts.selected.call(this.picker.select,this,a)},a.prototype.create_node=function(){var a,b,c,d;return this.node=jQuery("<li/>"),a=jQuery("<img class='image_picker_image'/>"),a.attr("src",this.option.data("img-src")),d=jQuery("<div class='thumbnail'>"),c=this.option.data("img-class"),c&&(this.node.addClass(c),a.addClass(c),d.addClass(c)),b=this.option.data("img-alt"),b&&a.attr("alt",b),d.on("click",this.clicked),d.append(a),this.opts.show_label&&d.append(jQuery("<p/>").html(this.label())),this.node.append(d),this.node},a}()}).call(this);